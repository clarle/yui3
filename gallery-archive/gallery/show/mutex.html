<html>
	<head>
		<title>YUI Library - Gallery :: Mutex</title>
		<link href="https://github.com/solmsted" rel="author" title="solmsted" />
		<meta charset="utf-8" />
		<link href="http://yui.yahooapis.com/combo?2.8.2/build/reset-fonts-grids/reset-fonts-grids.css" rel="stylesheet" />
		<link href="../../assets/skin/yuilib-08.25.2011.css" rel="stylesheet" />
		<link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic" rel="stylesheet" />
		<link href="http://yui.yahooapis.com/3.9.0/build/cssgrids/cssgrids-min.css" rel="stylesheet" />
		<link href="../../combo/css@main-min.css" rel="stylesheet" />
		<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible" />
		<meta content="/xrds.xml" http-equiv="X-XRDS-Location" />
		<link href="../../img/favicon.png" rel="shortcut icon" type="image/png" />
	</head>
	<body class="yui3-skin-sam">
		<div id="wrap">
			<div class="yui-t2 gallery" id="doc3"><a name="top"></a><div class="yui3-g" id="hd">
					<ul class="gallery-header-links">
						<li><a href="http://www.yuilibrary.com">YUI Home</a><li><a href="../index.html">Gallery Archive</a></ul>
					<div class="content">
						<div class="yui3-u-1-4">
							<ul id="userinfo">
							</ul>
						</div>
					</div>
				</div>
				<div id="bd">
					<div class="yui3-u-1" id="breadcrumbs">
						<ul class="breadcrumbs">
							<li class="crumb"><a href="http://yuilibrary.com/">YUI</a><li class="separator">&gt;<li class="crumb"><a href="http://yuilibrary.com/community/">Community</a><li class="separator">&gt;<li class="crumb"><a href="../index.html">Gallery</a></ul>
					</div>
					<div class="content" id="docs-hd">
						<h1>Gallery</h1>
					</div>
					<div id="deprecated">
						<p>The Gallery is deprecated. No new Gallery components may be submitted, and modifying existing components is disabled. For more information please read the <a href="http://www.yuiblog.com/blog/2014/06/16/yui-gallery-deprecation-announcement/">Gallery Deprecation blog post</a>. This is a static snapshot of the Gallery for archive purposes. </div>
					<div id="content-wrap">
						<div class="yui-b">
							<div class="sidenav">
								<div class="sidebox">
									<div class="hd">
										<h2>Modules</h2>
									</div>
									<div class="bd">
										<ul class="blank">
											<li><img src="../../assets/home.png" /> <a href="../index.html">Home</a><li><img src="../../assets/gallery/star.png" /> <a href="../featured.html">Featured</a><li><img src="../../assets/gallery/thumb_up.png" /> <a href="../popular.html">Popular</a><li><img src="../../assets/gallery/greenled.png" /> <a href="../new.html">New</a><li><img src="../../assets/gallery/script_code_red.png" /> <a href="../show.html">All</a></ul>
									</div>
								</div>
								<div class="sidebox">
									<div class="hd">
										<h2>Documentation</h2>
									</div>
									<div class="bd">
										<ul class="blank">
											<li><img src="../../assets/script.png" /> <a href="http://yui.github.com/yogi/">Yogi Documentation</a><li><img src="../../assets/notepaper.png" /> <a href="http://yui.github.com/shifter/">Shifter Documentation</a><li><img src="../../assets/gallery/book.png" /> <a href="http://yuilibrary.com/yui/docs/tutorials/gallery">Developer Guide</a><li><img src="../../assets/gear.png" /> <a href="../setup.html">Module Setup</a></ul>
									</div>
								</div>
							</div>
						</div>
						<div id="yui-main">
							<div class="yui-b" id="gallery">
								<div class="yui-g">
									<div class="nav" id="ctxtnav">
										<h2>Context Navigation</h2>
										<ul>
										</ul>
									</div>
									<div class="warning"> YUI Library is not responsible for bugs or support with this module. It is available as a free service. For support please contact the module owner with the provided links. </div>
									<div class="gallery-item" id="gallery-item_590">
										<div class="item-hd">
											<h2>Mutex (gallery-mutex) <span class="oncdn" title="This module is available on the CDN.">on cdn</span></h2> Last Updated: <span title="23 Jun 2012 00:21">06/23/12</span><div class="votes"><a class="up" href="#" title="Vote this item up.">+</a> <span>0</span> <a class="down" href="#" title="Vote this item down.">-</a></div>
										</div>
										<div class="mod">
											<div class="yui-gf profile">
												<div class="yui-u first">
													<h3><img class="medal" src="../../assets/medal_silver.png" title="CLA Signed" /> <span class="gallery-user">Steven Olmsted</span></h3>
													<h4>YUI Contributor</h4>
													<p><img src="http://www.gravatar.com/avatar/d49156801406cf2236d35e086149691a?s=64&d=http://yuilibrary.com/assets/gravatar-64.png" /><p><a href="../user/solmsted.html">See 42 more by this user.</a> Created: <span title="16 Apr 2012 02:54">04/16/12</span><br /> Last CDN Push: <span title="12 Dec 2013 21:07">12/12/13</span><br /> Build Tag: <a href="../buildtag/mutex/gallery-2013.12.12-21-06.html">gallery-2013.12.12-21-06</a><br /> Project: <a href="http://yuilibrary.com/projects/yui3">YUI 3</a><br /> License: <a href="http://yuilibrary.com/license/" target="_blank">YUI BSD</a><br /> YUI Version: 3.5.1<br /> Free for use. </div>
												<div class="yui-u">
													<div class="desc"><span class="wikipage"><p>Most people believe that Since JavaScript does not provide a multi-threaded shared memory environment, JavaScript is completely free from concurrency issues. This is true at a low level; JavaScript developers don't need to worry about race conditions between multiple processes or threads writing to the same memory location. At a higher level, asynchronous operations still allow for similar problems to occur.<p>Imagine a function that does the following:<p>1. Check the value of a variable.<br /> 2. If the value is undefined:<br /> . 1. Make a request to a server.<br /> . 2. Receive data.<br /> . 3. Set the value of the variable.<br /> 3. Pass the variable to a callback function.<p>It seems common for web applications to lazy load data like this as needed. Now imagine that there are several separate modules within a web application which all require this data. It's possible for the first module to call this function, the function sees that the value is undefined, and sends a request to a server. Then before the request returns, the second module calls this function, the function sees that the value is undefined and sends a request to a server. Then before both of those requests return, the third module calls this function, the function sees that the value is undefined and sends a request to a server. In this case, three requests are made to a server for the same data.<p>It would be far better if the second and third calls to the function just waited for the first request to complete. Y.Mutex makes it easier to accomplish this functionality.<p>Y.Mutex provides a concept of locking a resource. Once an exclusive resource lock is obtained, other parts of an application which attempt to access the same resource, will have to wait until that resource is unlocked.<p>The function above could be rewritten as follows:<p>1. Obtain an exclusive lock for a variable.<br /> 2. Check the value of the variable.<br /> 3. If the value is undefined:<br /> . 1. Make a request to a server.<br /> . 2. Receive data.<br /> . 3. Set the value of the variable.<br /> 4. Unlock the variable.<br /> 5. Pass the variable to a callback function.<p>This way, second or third or more calls to the function, before the first request is complete, will always wait for the request to complete instead of sending multiple unnecessary requests.<p>Just like locking in multi threaded applications, there are disadvantages and dangers to locking. There is a small amount of overhead added to every resource access, even when the chances for concurrency issues are very small. Once a lock is obtained, it must be unlocked; so error handling and time outs are important to ensure that the entire application doesn't break when something goes wrong. It is possible to cause a deadlock when locking multiple resources at once.<p>One advantage Y.Mutex has in JavaScript over other multi threaded applications, the locks are asynchronous. The application is not blocked while waiting to acquire a lock. Even if a deadlock occurs, other parts of the application are not affected. Y.Mutex also provides multiple ways to cancel a particular lock, so there are extra possibilities to recover from locking errors.<p>Y.Mutex offers exclusive locks, shared locks, and upgradable locks. When a resource is locked by an exclusive lock, Y.Mutex guarantees that no other locks will be granted for the resource until the resource is unlocked. When a resource is locked by a shared lock, Y.Mutex allows the resource to be locked by an unlimited number of other shared locks at the same time and/or one single upgradable lock. When a resource is locked by multiple shared locks, an exclusive lock can not be obtained until all of the shared locks have been unlocked. An upgradable lock can be upgraded to act as an exclusive lock. Shared locks are generally used when just reading values. Exclusive locks are generally used when writing values.<p>Y.Mutex provides a way to deal with asynchronous concurrency issues, but it does not prevent them. If code from part of an application uses Y.Mutex to lock a resource, there is nothing stopping code from another part of the application from ignoring the lock and accessing the resource directly. Y.Mutex does not handle real multi threaded or multi process concurrency issues.</span></div>
												</div>
												<div class="tags">
													<ul>
														<li>Tags: <li><a href="../tag/shared.html" title="Search by this tag: shared">shared</a><li><a href="../tag/lock.html" title="Search by this tag: lock">lock</a><li><a href="../tag/resource.html" title="Search by this tag: resource">resource</a><li><a href="../tag/solmsted.html" title="Search by this tag: solmsted">solmsted</a><li><a href="../tag/exclusive.html" title="Search by this tag: exclusive">exclusive</a><li><a href="../tag/concurrent.html" title="Search by this tag: concurrent">concurrent</a><li><a href="../tag/concurrency.html" title="Search by this tag: concurrency">concurrency</a><li><a href="../tag/asynchronous.html" title="Search by this tag: asynchronous">asynchronous</a><li><a href="../tag/async.html" title="Search by this tag: async">async</a><li><a href="../tag/mutex.html" title="Search by this tag: mutex">mutex</a></ul>
												</div>
											</div>
										</div>
										<ul class="gallery-links">
											<li class="download empty">Download<li class="docs"><a href="http://solmsted.github.com/yui3-gallery/api/modules/gallery-mutex.html" target="_blank" title="Docs">Docs</a><li class="homepage"><a href="mutex.html" target="_blank" title="Homepage">Homepage</a><li class="bugs"><a href="https://github.com/solmsted/yui3-gallery/issues?labels=gallery-mutex" target="_blank" title="Bugs">Bugs</a><li class="source"><a href="https://github.com/solmsted/yui3-gallery/tree/master/src/gallery-mutex" target="_blank" title="Source">Source</a><li class="example"><a href="http://jsfiddle.net/kJ5bG/" target="_blank" title="Example">Example</a><li class="forum empty">Forum<li class="history"><a href="../history/mutex.html" title="History">History</a></ul>
										<div class="mod"><span class="wikipage"><p>Resources are locked by name. Y.Mutex has three public static methods.<p>To obtain an exclusive lock:<br /> Y.Mutex.exclusive(resourceName, callbackFunction, timeout);<p>To obtain a shared lock:<br /> Y.Mutex.shared(resourceName, callbackFunction, timeout);<p>To obtain an upgradable lock:<br /> Y.Mutex.upgradable(resourceName, callbackFunction, timeout);<p>resourceName is the string name of the resource to lock.<p>callbackFunction is the function that is called when the lock is obtained. It is guaranteed not to be called synchronously. It is guaranteed not to be called more than once. It is not guaranteed to ever be called. The callbackFunction is passed the unlock function as its first argument which must be called in order to release the lock. For upgradable locks only, the second argument is the exclusive function which may be called to switch the upgradable lock to exclusive mode. The exclusive function accepts a callback function as its only argument. This callback function gets called once exclusivity is achieved. It is guaranteed not to be called synchronously. It is guaranteed not to be called more than once. It is not guaranteed ever to be called. The callback function is passed one argument, the shared function which may be called to switch the upgradable lock back to shared mode. The shared function accepts a callback function as its only argument. This callback function gets called once exclusivity is revoked. It is guaranteed not to be called synchronously. It is guaranteed not to be called more than once. It is not guaranteed ever to be called. The callback function is passed one argument, the exclusive function which may be called to switch the upgradable lock to exclusive mode.<p>timeout is the optional approximate time in milliseconds to wait after the callbackFunction has been called. Once the timeout has expired, if the callback function hasn't yet called the unlock function, the lock will be automatically released. This does not halt, stop, or prevent anything that the callbackFunction might still be doing asynchronously; it just releases the lock. Using timeout is one way to reduce the possibility of deadlocks, but it comes with the risk of allowing concurrent access to the resource.<p>Both Y.Mutex.exclusive, Y.Mutex.shared, and Y.Mutex.upgradable return an object with a cancel method. When the cancel method is called, if the callback function hasn't yet called the unlock function, the lock will be automatically released. This does not halt, stop, or prevent anything that the callbackFunction might still be doing asynchronously; it just releases the lock. Using the cancel method is one way to reduce the possibility of deadlocks, but it comes with the risk of allowing concurrent access to the resource.</span><h3 id="code">Code Sample</h3>
											<div class="syntax-highlight" id="yui-syn-1"><pre class="html4strict" style="font-family:monospace;"><span style="color: #009900;">&lt;<span style="color: #000000; font-weight: bold;">script</span> <span style="color: #000066;">src</span><span style="color: #66cc66;">=</span><span style="color: #ff0000;">&quot;http://yui.yahooapis.com/3.5.1/build/yui/yui-min.js&quot;</span>&gt;&lt;<span style="color: #66cc66;">/</span><span style="color: #000000; font-weight: bold;">script</span>&gt;</span></pre><textarea id="yui-syn-1-plain">&lt;script src=&quot;http://yui.yahooapis.com/3.5.1/build/yui/yui-min.js&quot;&gt;&lt;/script&gt;</textarea>
											</div>
											<div class="syntax-highlight" id="yui-syn-2"><pre class="javascript" style="font-family:monospace;">YUI<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span>
    <span style="color: #006600; font-style: italic;">//Last Gallery Build of this module</span>
    gallery<span style="color: #339933;">:</span> <span style="color: #3366CC;">'gallery-2013.12.12-21-06'</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span>.<span style="color: #003366; font-weight: bold;">use</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'gallery-mutex'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span>Y<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #003366; font-weight: bold;">var</span> a <span style="color: #339933;">=</span> <span style="color: #CC0000;">0</span><span style="color: #339933;">,</span>
        getA <span style="color: #339933;">=</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>callbackFunction<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
            Y.<span style="color: #660066;">Mutex</span>.<span style="color: #660066;">exclusive</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'a'</span><span style="color: #339933;">,</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>unlock<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                <span style="color: #000066; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                    unlock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                    callbackFunction<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #009900;">&#125;</span> <span style="color: #000066; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
                    Y.<span style="color: #660066;">io</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'http://my.server.com/get/a'</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#123;</span>
                        on<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span>
                            complete<span style="color: #339933;">:</span> <span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>transactionId<span style="color: #339933;">,</span> response<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
                                a <span style="color: #339933;">=</span> response.<span style="color: #660066;">responseText</span><span style="color: #339933;">;</span>
                                unlock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                                callbackFunction<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                            <span style="color: #009900;">&#125;</span>
                        <span style="color: #009900;">&#125;</span>
                    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
                <span style="color: #009900;">&#125;</span>
            <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
    getA<span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// Do something with a</span>
    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
    getA<span style="color: #009900;">&#40;</span><span style="color: #003366; font-weight: bold;">function</span> <span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #006600; font-style: italic;">// Do something else with a</span>
    <span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre><textarea id="yui-syn-2-plain">YUI({
    //Last Gallery Build of this module
    gallery: 'gallery-2013.12.12-21-06'
}).use('gallery-mutex', function(Y) {

    var a = 0,

        getA = function (callbackFunction) {

            Y.Mutex.exclusive('a', function (unlock) {

                if (a) {

                    unlock();

                    callbackFunction(a);

                } else {

                    Y.io('http://my.server.com/get/a', {

                        on: {

                            complete: function (transactionId, response) {

                                a = response.responseText;

                                unlock();

                                callbackFunction(a);

                            }

                        }

                    });

                }

            });

        };



    getA(function (a) {

        // Do something with a

    });





    getA(function (a) {

        // Do something else with a

    });

});</textarea>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="ft">
					<p class="copyright"> All code on this site is licensed under the <a href="http://yuilibrary.com/license/">BSD License</a> unless stated otherwise.<br />
				</div>
			</div>
		</div>
	</body>
</html>